/*! yet-another-coffescript-skeleton - v0.0.2 - last build: 2013-08-15 22:14:19 */
(function(){var r,n,t,e,i,o,u,l,a,f,s,h,c,p,b,g;g=true;n=5;r=15;u=function(r){if(g){console.log(r)}return r};o=function(r){if(g){$("body").append(r)}return r};a=function(r,n,t,e,i){var o;if(t==null){t=0}if(e==null){e=0}if(i==null){i=0}o=Math.PI/180;n.save();n.translate(t,e);n.rotate(i*o);n.drawImage(r,-(r.width/2),-(r.height/2));n.restore();return true};c=function(r,n,t){return 3*r+4*n+t>>>3};t=function(r,n){var t,e,i;t=r.color;e=n.color;i=(3*t[0]+4*t[1]+t[2]>>>3)-(3*e[0]+4*e[1]+e[2]>>>3);return i};l=function(n,t,e,i,o,u){if(e==null){e=0}if(i==null){i=0}if(o==null){o=0}if(u==null){u=false}if(u){a(FE.mirror(t.part),n,e*r,i*r,o)}else{a(t.part,n,e*r,i*r,o)}return true};p=function(r,n){var e,i;e=n.length;i=n.sort(t);u("sorted_by_brightness_parts");u(i);return function(n,t,o,u,a,f){var s,h,p;if(u==null){u=0}if(a==null){a=false}s=c(n[0],n[1],n[2]);h=Math.floor(s/256*e);p=i[h];l(r,p,t,o,u,a);return[n,t,o,f]}};e=function(r,n,t,e){var i,u;u=[];i=function(i,l){var a,f,s,h,c;i=FE.hardResize(i,n,t);if(l&&l.length===3){c=l[0],s=l[1],a=l[2];u.push({part:i,color:[c,s,a,1]})}else{h=FE.pixelyResize(i,1,1);f=function(r,n,t,e,o){return u.push({part:i,color:[r,n,t,1]})};FE.rgba(h,f,function(r){return null})}if(u.length===$(r).size()){_.each(u,function(r){o($('<div><span style="background-color:rgba('+r.color[0]+","+r.color[1]+","+r.color[2]+","+r.color[3]+')">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div>'));return o($(r.part))});return e(u)}};return $(r).each(function(r){var n,t;n=false;t=$(this).attr("data-rgb");if(t){n=_.map(t.split(","),function(r){return parseInt(r)})}return FE.byImage(this,function(r){return i(r,n)})})};s=function(r,n){return $("#out").html(r)};f=function(r,n){o(r);return o(n)};h=function(r){var n,t,e,i;i=r.width;t=r.height;e=[];n=function(r,n,t,o,u){var l;l=Math.floor(u/4);return e.push({y:Math.floor(l/i),x:Math.floor(l%i),color:[r,n,t,1],rotation:_.random(0,360),mirror:_.random(0,1)===0?false:true,pixel_nr:l})};FE.rgba(r,n,function(r){return null});return e};i=function(r,n,t,e,i,u){var l,a,f;if(n==null){n=20}if(t==null){t=20}if(e==null){e=.2}if(i==null){i=r.width}if(u==null){u=r.height}if(e>=1){e=0}f=Math.floor(i/(n*(1-e)));a=Math.floor(u/(t*(1-e)));l=FE.pixelyResize(r,f,a);o(l);return[l,f,a]};b=function(n,t,e,u){var l,a,c,b,g,d,v,m,F,E,y,w,M,$,x,z,R,I,k,q,A;if(e==null){e=s}if(u==null){u=f}a=n.width;l=n.height;v=a*5;d=l*5;q=i(n,t[0].part.width,t[0].part.height,.3,v,d),x=q[0],I=q[1],z=q[2];o(x);o(FE.pixelyResize(x,n.width,n.height));$=Math.floor(I*t[0].part.width*(1-.3));y=Math.floor(z*t[0].part.height*(1-.3));A=FE.newCanvasToolbox(I*r,z*r),F=A[0],E=A[1],w=A[2],M=A[3];c=p(E,t);R=h(x);k=_.shuffle(R);m=0;g=false;return(b=function(){var r,n,t,i;if(m>=k.length){r=FE.hardResize(F,v,d);return u(r,F)}else{t=function(r){var n,t;t=m+r;n=k[t];if(n){c(n.color,n.x,n.y,n.rotation,n.mirror,m);return e(FE.hardResize(F,a,l),F)}};for(n=i=0;i<=10;n=++i){t(n)}m=m+10;return requestAnimationFrame(b)}})()};e(".parts",40,40,function(r){return FE.byImage($("#testimage").get(0),function(n){return b(n,r)})})}).call(this);